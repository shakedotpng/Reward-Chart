<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reward Chart</title>
<style>
  body {
    max-width: 600px;
    margin: auto;
    font-family: Arial, sans-serif;
    padding: 1em;
  }
  #status {
    display: flex;
    justify-content: space-around;
    font-size: 1.4rem;
    margin-bottom: 1em;
  }
  #taskGrid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1em;
  }
  .task-btn {
    background: #f0f0f0;
    border: 2px solid #ccc;
    border-radius: 8px;
    padding: 1em;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 1rem;
    transition: border-color 0.2s;
  }
  .task-btn:hover {
    border-color: #888;
  }
  .task-icon {
    font-size: 2.5rem;
    margin-bottom: 0.5em;
  }
  #edit-tasks-btn {
    margin-top: 1em;
    width: 100%;
    padding: 1em;
    font-size: 1.2rem;
    cursor: pointer;
  }

  /* Modal styles */
  #modal {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
  }
  #modalContent {
    background: white;
    padding: 2em;
    border-radius: 10px;
    max-width: 90%;
    text-align: center;
  }
  #modal button {
    margin-top: 1em;
    padding: 0.5em 1.5em;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="status">
  <div>⭐ Stars: <span id="starsCount">0</span></div>
  <div>Points: <span id="pointsCount">0</span></div>
</div>

<div id="taskGrid"></div>

<button id="edit-tasks-btn" onclick="goToEdit()">Edit Tasks</button>

<!-- Custom modal for messages -->
<div id="modal">
  <div id="modalContent">
    <div id="modalMessage"></div>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<script>
  const tasks = {
    "Washing Towels": { pts: 1, icon: "🧺" },
    "Meds on time": { pts: 2, icon: "💊" },
    "Full Shower": { pts: 2, icon: "🚿" },
    "Reading your book": { pts: 2, icon: "📚" },
    "Waking up before 9:30": { pts: 2, icon: "⏰" },
    "Brushing Teeth": { pts: 3, icon: "🦷" },
    "Skin Care Routine": { pts: 3, icon: "🧴" },
    "Changing Bedding": { pts: 3, icon: "🛏️" },
    "Putting all Clothes away": { pts: 3, icon: "👕" },
    "Watching a TV Show": { pts: 3, icon: "📺" },
    "Eating 3 meals": { pts: 4, icon: "🍽️" },
    "Watching a Film": { pts: 4, icon: "🎬" },
    "Washing Dishes": { pts: 4, icon: "🍽️" },
    "Going to Gym": { pts: 8, icon: "🏋️" }
  };

  let points = parseInt(localStorage.getItem('points')) || 0;
  let stars = parseInt(localStorage.getItem('stars')) || 0;

  function saveData() {
    localStorage.setItem('points', points);
    localStorage.setItem('stars', stars);
  }

  function updateUI() {
    document.getElementById('pointsCount').textContent = points;
    document.getElementById('starsCount').textContent = stars;

    const grid = document.getElementById('taskGrid');
    grid.innerHTML = '';

    for (const [task, data] of Object.entries(tasks)) {
      const btn = document.createElement('button');
      btn.className = 'task-btn';
      btn.innerHTML = `<div class="task-icon">${data.icon}</div><div>${task}</div><small>${data.pts} pts</small>`;
      btn.onclick = () => {
        points += data.pts;
        if (points >= 20) {
          stars++;
          points -= 20;
          showModal('⭐ Star earned! ⭐');
        }
        saveData();
        updateUI();
      };
      grid.appendChild(btn);
    }
  }

  function goToEdit() {
    showModal('Edit screen not yet implemented.');
  }

  // Modal control
  function showModal(msg) {
    document.getElementById('modalMessage').textContent = msg;
    document.getElementById('modal').style.display = 'flex';
  }
  function closeModal() {
    document.getElementById('modal').style.display = 'none';
  }

  updateUI();
</script>
<div id="editScreen" style="display:none; max-width:600px; margin:auto; padding:1em;">
  <h2>Edit Tasks</h2>
  <div id="editTaskList"></div>
  <button onclick="addTask()">+ Add Task</button>
  <br/><br/>
  <button onclick="saveTasks()">Save & Return</button>
  <button onclick="cancelEdit()">Cancel</button>
</div>

<script>
  // Keep tasks as an object or load from localStorage
  let tasks = JSON.parse(localStorage.getItem('tasks')) || {
    "Washing Towels": { pts: 1, icon: "🧺" },
    "Meds on time": { pts: 2, icon: "💊" },
    "Full Shower": { pts: 2, icon: "🚿" },
    "Reading your book": { pts: 2, icon: "📚" },
    "Waking up before 9:30": { pts: 2, icon: "⏰" },
    "Brushing Teeth": { pts: 3, icon: "🦷" },
    "Skin Care Routine": { pts: 3, icon: "🧴" },
    "Changing Bedding": { pts: 3, icon: "🛏️" },
    "Putting all Clothes away": { pts: 3, icon: "👕" },
    "Watching a TV Show": { pts: 3, icon: "📺" },
    "Eating 3 meals": { pts: 4, icon: "🍽️" },
    "Watching a Film": { pts: 4, icon: "🎬" },
    "Washing Dishes": { pts: 4, icon: "🍽️" },
    "Going to Gym": { pts: 8, icon: "🏋️" }
  };

  // Show edit screen
  function goToEdit() {
    document.getElementById('editScreen').style.display = 'block';
    document.getElementById('status').style.display = 'none';
    document.getElementById('taskGrid').style.display = 'none';
    document.getElementById('edit-tasks-btn').style.display = 'none';
    renderEditList();
  }

  // Render the editable task list with inputs
  function renderEditList() {
    const container = document.getElementById('editTaskList');
    container.innerHTML = '';
    for (const [taskName, data] of Object.entries(tasks)) {
      const div = document.createElement('div');
      div.style.marginBottom = '1em';

      div.innerHTML = `
        <input type="text" value="${taskName}" class="edit-task-name" style="width:45%" />
        <input type="number" min="1" value="${data.pts}" class="edit-task-pts" style="width:20%" />
        <input type="text" value="${data.icon}" maxlength="2" class="edit-task-icon" style="width:20%" />
        <button onclick="deleteTask('${taskName}')">Delete</button>
      `;
      container.appendChild(div);
    }
  }

  // Add blank task input fields
  function addTask() {
    const container = document.getElementById('editTaskList');
    const div = document.createElement('div');
    div.style.marginBottom = '1em';

    div.innerHTML = `
      <input type="text" placeholder="Task Name" class="edit-task-name" style="width:45%" />
      <input type="number" min="1" placeholder="Points" class="edit-task-pts" style="width:20%" />
      <input type="text" placeholder="Emoji" maxlength="2" class="edit-task-icon" style="width:20%" />
      <button onclick="this.parentElement.remove()">Delete</button>
    `;
    container.appendChild(div);
  }

  // Delete a task by name (from current tasks object)
  function deleteTask(name) {
    if (confirm(`Delete task "${name}"?`)) {
      delete tasks[name];
      renderEditList();
    }
  }

  // Save edited tasks and return to main screen
  function saveTasks() {
    const names = document.querySelectorAll('.edit-task-name');
    const pts = document.querySelectorAll('.edit-task-pts');
    const icons = document.querySelectorAll('.edit-task-icon');

    let newTasks = {};
    for (let i = 0; i < names.length; i++) {
      const name = names[i].value.trim();
      const point = parseInt(pts[i].value);
      const icon = icons[i].value.trim() || '❓';
      if (name && point > 0) {
        newTasks[name] = { pts: point, icon: icon };
      }
    }
    tasks = newTasks;
    localStorage.setItem('tasks', JSON.stringify(tasks));
    exitEdit();
    updateUI();  // Rebuild main screen with updated tasks
  }

  // Cancel editing (discard changes)
  function cancelEdit() {
    if (confirm('Discard changes?')) {
      exitEdit();
    }
  }

  // Hide edit screen, show main UI
  function exitEdit() {
    document.getElementById('editScreen').style.display = 'none';
    document.getElementById('status').style.display = 'flex';
    document.getElementById('taskGrid').style.display = 'grid';
    document.getElementById('edit-tasks-btn').style.display = 'block';
  }
</script>
</body>
</html>
